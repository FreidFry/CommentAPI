# üßµ Commenting & Threads

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –æ–±—Å—É–∂–¥–µ–Ω–∏–π, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ –±–∞–∑–µ **.NET 8**, **MassTransit**, **Redis** –∏ **PostgreSQL**. –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π –±–ª–∞–≥–æ–¥–∞—Ä—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É API –∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏, –∞ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–∞—Ç—Ç–µ—Ä–Ω–∞ **Write-Behind**.

---

## üèõ 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `RUN_MODE`:

* **API Node (`RUN_MODE=API`)**: –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –≤ RabbitMQ.
* **Worker Node (`RUN_MODE=Worker`)**: –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á: —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞, —Ä–µ—Å–∞–π–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∑–∞–≥—Ä—É–∑–∫–∞ –≤ S3, –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î –∏ –ø—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞.
    * *–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—É—â–µ–Ω–æ 4 —Ä–µ–ø–ª–∏–∫–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤.*

---

## üíæ 2. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:
* **UserModel**: –£—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏, —Ö—ç—à–∏ –ø–∞—Ä–æ–ª–µ–π, —Ä–æ–ª–∏.
* **ThreadModel**: –í–µ—Ç–∫–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞.
* **CommentModel**: –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ.
    * `ParentDepth`: –£—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.
    * `Media`: –°—Å—ã–ª–∫–∏ –Ω–∞ S3 (–æ—Ä–∏–≥–∏–Ω–∞–ª—ã –∏ –º–∏–Ω–∏–∞—Ç—é—Ä—ã).
* **NotificationModel**: –ú–æ–¥–µ–ª—å —Å–æ–±—ã—Ç–∏–π –¥–ª—è SignalR –∏ –∏—Å—Ç–æ—Ä–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

---

## ‚öôÔ∏è 3. –§–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º –º–∏–≥—Ä–∞—Ü–∏–∏
–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ—Ç–∫–ª–∏–∫–∞ API –¥–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Redis, –∞ –∑–∞—Ç–µ–º –º–∏–≥—Ä–∏—Ä—É—é—Ç –≤ –ë–î:
1.  [**Comment Migration**](./Comment.Infrastructure/BackgroundServices/CommentMigrationWorker.cs): –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –∏–∑ `comments_queue` –ø–∞—á–∫–∞–º–∏ –ø–æ 30 —à—Ç. –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ PostgreSQL. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫–∏ –≤ –∫—ç—à–µ —Ç—Ä–µ–¥–æ–≤.
2.  [**Thread Migrations**](./Comment.Infrastructure/BackgroundServices/ThreadMigrationWorker.cs): –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –∏–∑ `threads_queue` –ø–∞—á–∫–∞–º–∏ –ø–æ 30 —à—Ç. –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ PostgreSQL. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫–∏ –≤ –∫—ç—à–µ.
3.  [**Notification Migration**](./Comment.Infrastructure/BackgroundServices/NotificationMigrationWorker.cs): –ü–µ—Ä–µ–Ω–æ—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –≤ –ë–î —Å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–æ–π —á–µ—Ä–µ–∑ **SignalR**.

### ‚ö° –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏.

### ‚ö° ThreadCacheWorker (Warm-up –∫–∞–∂–¥—ã–µ 25 –º–∏–Ω)
–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É "–≥–æ—Ä—è—á–∏—Ö" —Ç—Ä–µ–¥–æ–≤.
* **Dual-Variant Caching**: –°–æ–∑–¥–∞–µ—Ç –≤ Redis JSON-–º–æ–¥–µ–ª–∏ `details` (–ø–æ–ª–Ω—ã–π —Ç—Ä–µ–¥) –∏ `preview` (–∫—Ä–∞—Ç–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞).
* **Global Indexing**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Sorted Set `all_active_previews` –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–µ (Score = Ticks).
* **Self-Cleaning**: –û—Å—Ç–∞–≤–ª—è–µ—Ç –≤ –∫—ç—à–µ —Ç–æ–ª—å–∫–æ –¢–û–ü-100 –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.

### ‚ö° CommentsCacheWorker (Warm-up –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω)
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö.
* **Multi-Factor Indexing**: –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞ (Sorted Sets) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–¥–∞:
    1. `sort:createat` ‚Äî –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è.
    2. `sort:username` ‚Äî –ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ –∏–º–µ–Ω–∏ (Score = UTF8 Double).
    3. `sort:email` ‚Äî –ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ Email (Score = UTF8 Double).
* **Batching**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Redis Batch` –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–¥–∏–Ω —Å–µ—Ç–µ–≤–æ–π —Ü–∏–∫–ª.

---

## üõ° 4. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### HandlerWrapper (Cross-Cutting Concerns)
–í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `HandlerWrapper`, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–µ–≥–æ:
* **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Warning-–ª–æ–≥–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ > 500 –º—Å.
* **Traceability**: –°–∫–≤–æ–∑–Ω–æ–π `TraceId` —á–µ—Ä–µ–∑ `Activity.Current.Id`.
* **Resilience**: –û–±—Ä–∞–±–æ—Ç–∫–∞ `RequestTimeoutException` (504), `OperationCanceledException` (499) –∏ 500 –æ—à–∏–±–æ–∫.

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
* **XSS Protection**: –í—Ö–æ–¥—è—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (`Title`, `Content`, `Context`) —Å–∞–Ω–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ **IHtmlSanitize** (White-list).
* **S3 FileProvider**: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–∫–µ—Ç—ã (`image`, `txt`). –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Thumbnail —á–µ—Ä–µ–∑ `ImageSharp` –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π.
* **Captcha**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `ImageSharp`, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ Redis —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL.

---

## üõ† 5. –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ Redis

| –ö–ª—é—á | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `thread:{id}:details` | String (JSON) | –ü–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å —Ç—Ä–µ–¥–∞. |
| `all_active_previews` | Sorted Set | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–¥–æ–≤ (Score = Ticks). |
| `comments_queue` | List | –û—á–µ—Ä–µ–¥—å –Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (Write-buffer). |
| `threads_queue` | List | –û—á–µ—Ä–µ–¥—å –Ω–æ–≤—ã—Ö —Ç—Ä–µ–¥–æ–≤ (Write-buffer). |
| `captcha:{id}` | String | –í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–¥ –∫–∞–ø—á–∏. |
| `thread:{id}:comments:sort:createat` | **Sorted Set** | `DateTime.Ticks` |
| `thread:{id}:comments:sort:username` | **Sorted Set** | `double` (–∏–∑ UTF8) |
| `thread:{id}:comments:sort:email` | **Sorted Set** | `double` (–∏–∑ UTF8) |
| `comment:{id}` | **String** | JSON-–º–æ–¥–µ–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è |

---

## üì° 6. –ü—É—Ç—å –¥–∞–Ω–Ω—ã—Ö (Request Lifecycle)

1.  **Client** ‚ûî **API** (HandlerWrapper —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è).
2.  **API** ‚ûî **RabbitMQ** (–ö–æ–º–∞–Ω–¥–∞ MassTransit).
3.  **Worker** ‚ûî **Sanitization / Image Resizing** ‚ûî **Redis Queue**.
4.  **Migration Worker** ‚ûî **PostgreSQL Batch Save**.
5.  **SignalR Hub** ‚ûî **Real-time Notify Client**.

---

## ‚öôÔ∏è 7.–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Environment Variables)

## API Service
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `ASPNETCORE_ENVIRONMENT` | –û–∫—Ä—É–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ (Development/Production) |
| `ASPNETCORE_HTTP_PORTS` | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π HTTP –ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `ASPNETCORE_HTTPS_PORTS` | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π HTTPS –ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `ConnectionStrings__DefaultConnection` | –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL |
| `JWT__AUDIENCE` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª—è —Ç–æ–∫–µ–Ω–∞ |
| `JWT__EXPIRES_DAYS` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ JWT —Ç–æ–∫–µ–Ω–∞ –≤ –¥–Ω—è—Ö |
| `JWT__ISSUER` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑–¥–∞—Ç–µ–ª—è —Ç–æ–∫–µ–Ω–∞ |
| `JWT__SECRET_KEY` | –ö–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JWT |
| `Kestrel__httpDomen` | URL –∞–¥—Ä–µ—Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (HTTP) |
| `Kestrel__httpDomenSecure` | URL –∞–¥—Ä–µ—Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (HTTPS) |
| `DB__DbName` | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `DB__User` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `DB__Password` | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `DB__Server` | IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `DB__Port` | –ü–æ—Ä—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö |
| `RabbitMq__ConnectString` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±—Ä–æ–∫–µ—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–π RabbitMQ |
| `Redis__ConnectString` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É Redis |
| `Redis__DataInstanceName` | –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Redis |
| `Redis__CapchaInstanceName` | –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞–ø—á–∏ –≤ Redis |
| `PORT` | –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—á–∏–π –ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |

## Worker Service
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `S3__image__AccessKeyId` | ID –∫–ª—é—á–∞ –¥–æ—Å—Ç—É–ø–∞ S3 –¥–ª—è –±–∞–∫–µ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ |
| `S3__image__BucketName` | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `S3__image__SecretAccessKey` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ S3 –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `S3__image__PublicUrl` | –ü—É–±–ª–∏—á–Ω—ã–π URL (CDN) –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º |
| `S3__image__StorageUrl` | Endpoint API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `S3__txt__AccessKeyId` | ID –∫–ª—é—á–∞ –¥–æ—Å—Ç—É–ø–∞ S3 –¥–ª—è –±–∞–∫–µ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ |
| `S3__txt__BucketName` | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ |
| `S3__txt__SecretAccessKey` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ S3 –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ |
| `S3__txt__PublicUrl` | –ü—É–±–ª–∏—á–Ω—ã–π URL (CDN) –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ñ–∞–π–ª–∞–º |
| `S3__txt__StorageUrl` | Endpoint API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —Ç–µ–∫—Å—Ç–æ–≤ |
---

## üì° 8.API Endpoints (–û—Å–Ω–æ–≤–Ω—ã–µ)

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã API –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ `HandlerWrapper` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è SLA.

### Authentication (`api/auth`)
- `POST /register` ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `POST /login` ‚Äî –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT).
- `POST /logout` ‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è `Authorize`).

### Captcha (`api/captcha`)
- `GET /generate` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–ø—á–∏ –∏ ID —Å–µ—Å—Å–∏–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞.

### Threads (`/threads`)
- `GET /` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–¥–æ–≤ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ).
- `GET /{id}` ‚Äî –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ç—Ä–µ–¥–µ.
- `POST /` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç—Ä–µ–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è `Authorize`).
- `PUT /{id}/update` ‚Äî –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞/–∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç—Ä–µ–¥–∞.
- `DELETE /{id}` ‚Äî –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–¥–∞.
- `PUT /{id}` ‚Äî –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–Ω–µ–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–¥–∞.
- `GET /{id}/comments` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Ç—Ä–µ–¥–∞ (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —á–µ—Ä–µ–∑ Redis).

### Comments (`/comments`)
- `POST /` ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤/–º–µ–¥–∏–∞).
- `PUT /{id}` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.
- `DELETE /{id}` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.
- `GET /replyes` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.

### Notifications (`api/notification`)
- `GET /` ‚Äî –ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- `PATCH /{id}/mark-as-read` ‚Äî –ü–æ–º–µ—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ.
- `PATCH /mark-all-as-read` ‚Äî –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

### Profile (`/profile`)
- `GET /{id}` ‚Äî –ü—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
